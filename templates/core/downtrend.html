{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MNQ Chart Analysis - Trendline Markup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #eee;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00d9ff;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 20px;
        }
        
        .chart-container {
            position: relative;
            display: inline-block;
            margin: 0 auto;
            display: block;
            border: 2px solid #333;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
        }
        
        #chartImage {
            display: block;
            width: 100%;
            height: auto;
        }
        
        #markupCanvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .setup-card {
            background: #1a1a2e;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #00d9ff;
        }
        
        .setup-card.short {
            border-left-color: #ff6b6b;
        }
        
        .setup-card.range {
            border-left-color: #ffd700;
        }
        
        .setup-card h3 {
            color: #00d9ff;
            margin-bottom: 15px;
        }
        
        .setup-card.short h3 {
            color: #ff6b6b;
        }
        
        .setup-card.range h3 {
            color: #ffd700;
        }
        
        .trade-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #2a2a3e;
            font-size: 14px;
        }
        
        .trade-row:last-child {
            border-bottom: none;
        }
        
        .label {
            color: #888;
        }
        
        .value {
            color: #fff;
            font-weight: bold;
        }
        
        .profit { color: #00ff88; }
        .risk { color: #ff4444; }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            padding: 15px;
            background: #1a1a2e;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-line {
            width: 30px;
            height: 3px;
            border-radius: 2px;
        }
        
        .instructions {
            background: #2a1a1a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ff6b6b;
        }
        
        .instructions h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .instructions code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            color: #00d9ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="instructions">
            <h3>üìÅ Setup Instructions for Django:</h3>
            <ol style="line-height: 2; margin-left: 20px;">
                <li>Save your chart image as <code>mnq_chart.png</code> in your Django <code>static/images/</code> folder</li>
                <li>Update the image path in the code below (line with <code>chartImage.src</code>)</li>
                <li>The markup will automatically overlay on your chart</li>
                <li>Adjust the coordinate percentages in the drawMarkup() function to match your chart</li>
            </ol>
        </div>
        
        <h1>MNQ 5-Minute Chart Analysis</h1>
        <div class="subtitle">Trendline & Channel Trading Setups with Entry/Stop/Target</div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-line" style="background: #ff6b6b;"></div>
                <span>Descending Trendline (SHORT)</span>
            </div>
            <div class="legend-item">
                <div class="legend-line" style="background: #00ff88;"></div>
                <span>Ascending Trendline (LONG)</span>
            </div>
            <div class="legend-item">
                <div class="legend-line" style="background: #ffd700; height: 40px; width: 3px;"></div>
                <span>Range/Channel</span>
            </div>
            <div class="legend-item">
                <div style="width: 15px; height: 15px; border-radius: 50%; background: #ffaa00;"></div>
                <span>Trendline Touch</span>
            </div>
            <div class="legend-item">
                <div style="width: 18px; height: 18px; border-radius: 50%; background: #00ff88; border: 2px solid #fff;"></div>
                <span>LONG Entry</span>
            </div>
            <div class="legend-item">
                <div style="width: 18px; height: 18px; border-radius: 50%; background: #ff4444; border: 2px solid #fff;"></div>
                <span>SHORT Entry</span>
            </div>
        </div>
        
        <div class="chart-container" id="chartContainer">
            <img id="chartImage" src="" alt="Trading Chart">
            <canvas id="markupCanvas"></canvas>
        </div>
        
        <div class="analysis-grid">
            <div class="setup-card short">
                <h3>üìâ Setup #1: Descending Trendline</h3>
                <div class="trade-row">
                    <span class="label">Time Period:</span>
                    <span class="value">9:30 AM - 1:00 PM</span>
                </div>
                <div class="trade-row">
                    <span class="label">Pattern:</span>
                    <span class="value">Downtrend, lower highs</span>
                </div>
                <div class="trade-row">
                    <span class="label">Entry Example:</span>
                    <span class="value risk">~11:30 AM at 25,260</span>
                </div>
                <div class="trade-row">
                    <span class="label">Stop Loss:</span>
                    <span class="value risk">25,275 (15pts = $150)</span>
                </div>
                <div class="trade-row">
                    <span class="label">Target:</span>
                    <span class="value profit">25,200 (60pts = $600)</span>
                </div>
                <div class="trade-row">
                    <span class="label">R:R:</span>
                    <span class="value profit">1:4 ‚úì</span>
                </div>
            </div>
            
            <div class="setup-card range">
                <h3>‚ÜîÔ∏è Setup #2: Midday Range</h3>
                <div class="trade-row">
                    <span class="label">Time Period:</span>
                    <span class="value">11:00 AM - 1:30 PM</span>
                </div>
                <div class="trade-row">
                    <span class="label">Pattern:</span>
                    <span class="value">Sideways chop zone</span>
                </div>
                <div class="trade-row">
                    <span class="label">Range:</span>
                    <span class="value">25,180 - 25,270 (~90pts)</span>
                </div>
                <div class="trade-row">
                    <span class="label">Strategy:</span>
                    <span class="value">Fade boundaries or sit out</span>
                </div>
                <div class="trade-row">
                    <span class="label">Warning:</span>
                    <span class="value risk">‚ö†Ô∏è High whipsaw risk</span>
                </div>
            </div>
            
            <div class="setup-card">
                <h3>üìà Setup #3: Ascending Trendline ‚≠ê</h3>
                <div class="trade-row">
                    <span class="label">Time Period:</span>
                    <span class="value">1:30 PM - 3:30 PM</span>
                </div>
                <div class="trade-row">
                    <span class="label">Pattern:</span>
                    <span class="value">Clean uptrend, higher lows</span>
                </div>
                <div class="trade-row">
                    <span class="label">Entry (Third Touch):</span>
                    <span class="value profit">~3:00 PM at 25,215</span>
                </div>
                <div class="trade-row">
                    <span class="label">Stop Loss:</span>
                    <span class="value risk">25,200 (15pts = $150)</span>
                </div>
                <div class="trade-row">
                    <span class="label">Target:</span>
                    <span class="value profit">25,270+ (55pts = $550)</span>
                </div>
                <div class="trade-row">
                    <span class="label">R:R:</span>
                    <span class="value profit">1:3.7 ‚úì‚úì</span>
                </div>
                <div class="trade-row">
                    <span class="label">Result:</span>
                    <span class="value profit">‚úì WINNER - Hit 25,276</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DJANGO SETUP: Update this path to your static file location
        // Example: '/static/images/mnq_chart.png' or '{% static "images/_MNQ_2025-10-12_15-09-31.png" %}'
        const CHART_IMAGE_PATH = '/static/images/_MNQ_2025-10-12_15-09-31.png';
        
        const chartImage = document.getElementById('chartImage');
        const canvas = document.getElementById('markupCanvas');
        const ctx = canvas.getContext('2d');
        
        // Load the chart image
        chartImage.src = CHART_IMAGE_PATH;
        
        chartImage.onload = function() {
            // Set canvas size to match image
            canvas.width = chartImage.width;
            canvas.height = chartImage.height;
            
            // Draw the markup
            drawMarkup();
        };
        
        function drawMarkup() {
            const width = canvas.width;
            const height = canvas.height;
            
            // These percentages correspond to approximate positions on your chart
            // Adjust these based on where features appear in YOUR specific chart
            
            // ===== DESCENDING TRENDLINE (RED) =====
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 4;
            ctx.setLineDash([]);
            ctx.beginPath();
            // Connects morning highs: 9:45 AM, 10:45 AM, 11:30 AM, 12:30 PM
            ctx.moveTo(width * 0.08, height * 0.15);   // First high (9:45 AM, ~25,330)
            ctx.lineTo(width * 0.30, height * 0.28);   // Second high (10:45 AM, ~25,260)
            ctx.lineTo(width * 0.42, height * 0.28);   // Third high (11:30 AM, ~25,260)
            ctx.lineTo(width * 0.58, height * 0.32);   // Fourth touch (12:30 PM, ~25,240)
            ctx.stroke();
            
            // Label
            ctx.fillStyle = '#ff6b6b';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('DESCENDING TRENDLINE', width * 0.12, height * 0.12);
            ctx.font = '14px Arial';
            ctx.fillText('(SHORT Setups)', width * 0.12, height * 0.16);
            
            // Mark touches
            const descendingTouches = [
                {x: width * 0.08, y: height * 0.15, label: '1'},
                {x: width * 0.30, y: height * 0.28, label: '2'},
                {x: width * 0.42, y: height * 0.28, label: '3'}
            ];
            
            descendingTouches.forEach(touch => {
                ctx.fillStyle = '#ffaa00';
                ctx.beginPath();
                ctx.arc(touch.x, touch.y, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ffaa00';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('T' + touch.label, touch.x, touch.y - 15);
            });
            
            // Entry marker (example at third touch)
            ctx.fillStyle = '#ff4444';
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(width * 0.42, height * 0.28, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // ===== MIDDAY RANGE BOX (YELLOW) =====
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 3;
            ctx.setLineDash([8, 8]);
            
            const rangeLeft = width * 0.35;
            const rangeRight = width * 0.60;
            const rangeTop = height * 0.25;
            const rangeBottom = height * 0.55;
            
            ctx.strokeRect(rangeLeft, rangeTop, rangeRight - rangeLeft, rangeBottom - rangeTop);
            ctx.fillStyle = 'rgba(255, 215, 0, 0.05)';
            ctx.fillRect(rangeLeft, rangeTop, rangeRight - rangeLeft, rangeBottom - rangeTop);
            
            ctx.setLineDash([]);
            ctx.fillStyle = '#ffd700';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('MIDDAY CHOP ZONE', (rangeLeft + rangeRight) / 2, rangeTop - 10);
            ctx.font = '13px Arial';
            ctx.fillText('11:00 AM - 1:30 PM', (rangeLeft + rangeRight) / 2, rangeTop + 20);
            ctx.fillText('(Range or Sit Out)', (rangeLeft + rangeRight) / 2, rangeTop + 38);
            
            // ===== ASCENDING TRENDLINE (GREEN) =====
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 4;
            ctx.setLineDash([]);
            ctx.beginPath();
            // Connects afternoon lows: 1:30 PM, 2:15 PM, 3:00 PM
            ctx.moveTo(width * 0.62, height * 0.60);   // First low (1:30 PM, ~25,170)
            ctx.lineTo(width * 0.72, height * 0.55);   // Second low (2:15 PM, ~25,190)
            ctx.lineTo(width * 0.83, height * 0.48);   // Third low (3:00 PM, ~25,215)
            ctx.lineTo(width * 0.95, height * 0.40);   // Projection
            ctx.stroke();
            
            // Label
            ctx.fillStyle = '#00ff88';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('ASCENDING TRENDLINE', width * 0.95, height * 0.35);
            ctx.font = '14px Arial';
            ctx.fillText('(LONG Setups)', width * 0.95, height * 0.39);
            
            // Mark touches
            const ascendingTouches = [
                {x: width * 0.62, y: height * 0.60, label: '1'},
                {x: width * 0.72, y: height * 0.55, label: '2'},
                {x: width * 0.83, y: height * 0.48, label: '3 ‚≠ê'}
            ];
            
            ascendingTouches.forEach(touch => {
                ctx.fillStyle = '#00ffaa';
                ctx.beginPath();
                ctx.arc(touch.x, touch.y, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#00ffaa';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('T' + touch.label, touch.x, touch.y + 20);
            });
            
            // BEST ENTRY marker (third touch)
            ctx.fillStyle = '#00ff88';
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(width * 0.83, height * 0.48, 14, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // Entry annotation
            ctx.fillStyle = '#00ff88';
            ctx.font = 'bold 15px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('LONG ENTRY ‚≠ê', width * 0.84, height * 0.46);
            ctx.font = '12px Arial';
            ctx.fillText('~3:00 PM at 25,215', width * 0.84, height * 0.49);
            ctx.fillText('Stop: 25,200 (15pts)', width * 0.84, height * 0.52);
            ctx.fillText('Target: 25,270+ (55pts)', width * 0.84, height * 0.55);
            
            // Arrow showing move
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(width * 0.83, height * 0.48);
            ctx.lineTo(width * 0.92, height * 0.38);
            ctx.stroke();
            
            // Arrow head
            ctx.beginPath();
            ctx.moveTo(width * 0.92, height * 0.38);
            ctx.lineTo(width * 0.91, height * 0.40);
            ctx.lineTo(width * 0.93, height * 0.40);
            ctx.closePath();
            ctx.fillStyle = '#00ff88';
            ctx.fill();
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            canvas.width = chartImage.width;
            canvas.height = chartImage.height;
            drawMarkup();
        });
    </script>
</body>
</html>