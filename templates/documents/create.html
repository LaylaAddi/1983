{% extends 'base.html' %}

{% block title %}Create New Document - Section 1983 Document Generator{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card">
            <div class="card-header">
                <h2 class="mb-0"><i class="fas fa-plus-circle"></i> Create New Section 1983 Document</h2>
                <p class="mb-0 text-muted">Fill out the details of your civil rights case below</p>
            </div>
            <div class="card-body">
                <!-- Important Legal Disclaimer -->
                <div class="alert alert-warning" role="alert">
                    <strong><i class="fas fa-exclamation-triangle"></i> Legal Disclaimer:</strong>
                    This tool generates draft legal documents only. Always consult with a qualified attorney
                    before filing any legal documents in court. This is not legal advice.
                </div>
                <!-- Plaintiff Information -->
                <div class="alert alert-info" role="alert">
                    <h6><i class="fas fa-user"></i> Plaintiff Information</h6>
                    <p class="mb-1"><strong>Name:</strong> {{ profile.full_legal_name }}</p>
                    <p class="mb-1"><strong>Address:</strong> {{ profile.full_address }}</p>
                    <p class="mb-0"><strong>Phone:</strong> {{ profile.phone_number }}</p>
                    <small class="text-muted">This information will be included in your legal document.
                        <a href="{% url 'profile' %}">Update profile</a> if needed.</small>
                </div>
                <form method="post" novalidate>
                    {% csrf_token %}

                    <!-- Case Title -->
                    <div class="mb-4">
                        <label for="{{ form.title.id_for_label }}" class="form-label fw-bold">
                            {{ form.title.label }}
                            <span class="text-danger">*</span>
                        </label>
                        {{ form.title }}
                        {% if form.title.help_text %}
                        <div class="form-text">{{ form.title.help_text }}</div>
                        {% endif %}
                        {% if form.title.errors %}
                        <div class="text-danger">
                            {% for error in form.title.errors %}
                            <small>{{ error }}</small>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <!-- Description -->
                    <div class="mb-4">
                        <label for="{{ form.description.id_for_label }}" class="form-label fw-bold">
                            {{ form.description.label }}
                            <span class="text-danger">*</span>
                        </label>
                        {{ form.description }}
                        {% if form.description.help_text %}
                        <div class="form-text">{{ form.description.help_text }}</div>
                        {% endif %}
                        {% if form.description.errors %}
                        <div class="text-danger">
                            {% for error in form.description.errors %}
                            <small>{{ error }}</small>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <!-- Incident Details Row -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="{{ form.incident_date.id_for_label }}" class="form-label fw-bold">
                                {{ form.incident_date.label }}
                            </label>
                            {{ form.incident_date }}
                            {% if form.incident_date.help_text %}
                            <div class="form-text">{{ form.incident_date.help_text }}</div>
                            {% endif %}
                            {% if form.incident_date.errors %}
                            <div class="text-danger">
                                {% for error in form.incident_date.errors %}
                                <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.incident_location.id_for_label }}" class="form-label fw-bold">
                                {{ form.incident_location.label }}
                            </label>
                            {{ form.incident_location }}
                            {% if form.incident_location.help_text %}
                            <div class="form-text">{{ form.incident_location.help_text }}</div>
                            {% endif %}
                            {% if form.incident_location.errors %}
                            <div class="text-danger">
                                {% for error in form.incident_location.errors %}
                                <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Defendants -->
                    <div class="mb-4">
                        <label for="{{ form.defendants.id_for_label }}" class="form-label fw-bold">
                            {{ form.defendants.label }}
                        </label>
                        {{ form.defendants }}
                        {% if form.defendants.help_text %}
                        <div class="form-text">{{ form.defendants.help_text }}</div>
                        {% endif %}
                        {% if form.defendants.errors %}
                        <div class="text-danger">
                            {% for error in form.defendants.errors %}
                            <small>{{ error }}</small>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <!-- YouTube Video Evidence -->
                    <!-- YouTube Video Evidence -->
                    <div class="mb-4">
                        <div class="mb-4">
                            <label class="form-label fw-bold">Video Evidence</label>

                            <div class="alert alert-info mb-3">
                                <h6><i class="bi bi-info-circle"></i> How to Share Video Evidence</h6>
                                <ol class="mb-2">
                                    <li><strong>Navigate to the video:</strong> Go to YouTube and find the video showing
                                        the incident</li>
                                    <li><strong>Copy the URL:</strong> Copy the full web address from your browser's
                                        address bar</li>
                                    <li><strong>Set the timestamp:</strong> If the incident occurs at a specific time in
                                        the video, right-click on the video at that moment and select "Copy video URL at
                                        current time"</li>
                                    <li><strong>Paste below:</strong> Enter the complete YouTube URL in the appropriate
                                        field</li>
                                </ol>
                                <p class="mb-0"><strong>Important:</strong> Ensure you have permission to reference the
                                    video and that it clearly shows the incident described in your case. Body camera
                                    footage, security cameras, and witness recordings can all serve as valuable
                                    evidence.</p>
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.youtube_url_1.id_for_label }}" class="form-label">Primary Video
                                    Evidence</label>
                                {{ form.youtube_url_1 }}
                                {% if form.youtube_url_1.errors %}
                                <div class="text-danger">
                                    {% for error in form.youtube_url_1.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.youtube_url_2.id_for_label }}" class="form-label">Additional Video
                                    Evidence</label>
                                {{ form.youtube_url_2 }}
                                {% if form.youtube_url_2.errors %}
                                <div class="text-danger">
                                    {% for error in form.youtube_url_2.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.youtube_url_3.id_for_label }}" class="form-label">Additional Video
                                    Evidence</label>
                                {{ form.youtube_url_3 }}
                                {% if form.youtube_url_3.errors %}
                                <div class="text-danger">
                                    {% for error in form.youtube_url_3.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.youtube_url_4.id_for_label }}" class="form-label">Additional Video
                                    Evidence</label>
                                {{ form.youtube_url_4 }}
                                {% if form.youtube_url_4.errors %}
                                <div class="text-danger">
                                    {% for error in form.youtube_url_4.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Additional Evidence -->
                        <div class="mb-4">
                            <label for="{{ form.additional_evidence.id_for_label }}" class="form-label fw-bold">
                                {{ form.additional_evidence.label }}
                            </label>
                            {{ form.additional_evidence }}
                            {% if form.additional_evidence.help_text %}
                            <div class="form-text">{{ form.additional_evidence.help_text }}</div>
                            {% endif %}
                            {% if form.additional_evidence.errors %}
                            <div class="text-danger">
                                {% for error in form.additional_evidence.errors %}
                                <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> Create Document
                            </button>
                        </div>
                </form>
            </div>
        </div>

        <!-- Tips Card -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-lightbulb"></i> Tips for Creating Your Document</h5>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li><strong>Be specific:</strong> Include exact dates, times, and locations when possible</li>
                    <li><strong>Name all parties:</strong> List full names, badge numbers, departments, and supervisors
                    </li>
                    <li><strong>Document evidence:</strong> Mention all photos, videos, witnesses, and medical records
                    </li>
                    <li><strong>Describe violations:</strong> Clearly explain how your constitutional rights were
                        violated</li>
                    <li><strong>Save drafts:</strong> You can edit and update your document at any time</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-save draft functionality (future feature)
    let formData = {};

    // Character counters for text areas
    document.addEventListener('DOMContentLoaded', function () {
        const textareas = document.querySelectorAll('textarea');
        textareas.forEach(function (textarea) {
            const maxLength = textarea.getAttribute('maxlength');
            if (maxLength) {
                const counter = document.createElement('div');
                counter.className = 'form-text text-muted text-end';
                counter.innerHTML = `<small>${textarea.value.length}/${maxLength} characters</small>`;
                textarea.parentNode.appendChild(counter);

                textarea.addEventListener('input', function () {
                    counter.innerHTML = `<small>${this.value.length}/${maxLength} characters</small>`;
                });
            }
        });
    });

    // Form validation feedback
    document.querySelector('form').addEventListener('submit', function (e) {
        const requiredFields = document.querySelectorAll('input[required], textarea[required]');
        let hasErrors = false;

        requiredFields.forEach(function (field) {
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                hasErrors = true;
            } else {
                field.classList.remove('is-invalid');
            }
        });

        if (hasErrors) {
            e.preventDefault();
            alert('Please fill in all required fields.');
        }
    });
</script>
{% endblock %}